<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Project Rushing</title>
  <style>
    html,body { height:100%; margin:0; background:#000; color:#fff; font-family:Arial, sans-serif; }
    canvas { display:block; margin:0 auto; background:#000; }
    #ui {
      position:fixed; left:16px; top:16px; color:#fff; font-size:18px; z-index:10;
    }
    .popup {
      position:fixed; left:50%; top:8%; transform:translateX(-50%); padding:12px 18px;
      background:rgba(255,255,255,0.06); border:2px solid rgba(255,255,255,0.15);
      color:#fff; font-size:32px; border-radius:8px; pointer-events:none; z-index:20;
      text-align:center;
    }
  </style>
</head>
<body>
  <div id="ui"><strong>Combo:</strong> <span id="combo">0</span></div>
  <canvas id="game" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Game constants
    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;
    const JUDGE_X = 100;           // vertical judgement line x coordinate
    const NOTE_Y = 350;           // y position for all notes (matches original)
    const NOTE_RADIUS = 30;
    const NOTE_SPEED = 4;         // pixels per frame (approx same as original)
    const JUDGE_MIN_X = 0;      // leftmost active region (original used 100..300)
    const JUDGE_MAX_X = 200;      // rightmost active region

    // judgement boundaries (mirrors original numeric ranges)
    // We'll keep exact numbers used in original code for consistency
    function getJudgement(x) {
      if (x >= 0 && x < 36) return 'MISS';
      if (x >= 36 && x < 76) return 'L-GOOD';
      if (x >= 76 && x < 92) return 'L-PERFECT';
      if (x >= 92 && x <= 108) return 'ACE';
      if (x > 108 && x <= 124) return 'E-PERFECT';
      if (x > 124 && x <= 156) return 'E-GOOD';
      if (x > 156 && x <= 200) return 'MISS';
      return null;
    }

    // Note objects (start positions follow original: x1=440, x2=560, x3=680)
    const notes = [
      { x: 440, y: NOTE_Y, active: true },
      { x: 560, y: NOTE_Y, active: true },
      { x: 680, y: NOTE_Y, active: true }
    ];

    let combo = 0;
    const comboEl = document.getElementById('combo');

    // temporary popup text management
    let popupEl = null;
    let popupTimer = null;
    function showTemporaryText(text, ms = 90000) {
      if (popupEl) {
        popupEl.remove();
        popupEl = null;
        if (popupTimer) { clearTimeout(popupTimer); popupTimer = null; }
      }
      popupEl = document.createElement('div');
      popupEl.className = 'popup';
      popupEl.textContent = text;
      document.body.appendChild(popupEl);
      popupTimer = setTimeout(() => {
        if (popupEl) { popupEl.remove(); popupEl = null; }
        popupTimer = null;
      }, ms);
    }

    // drawing helpers
    function draw() {
      ctx.clearRect(0,0,WIDTH,HEIGHT);

      // judgement line (vertical)
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(JUDGE_X, HEIGHT);
      ctx.lineTo(JUDGE_X, 100);
      ctx.stroke();

      // draw notes
      ctx.lineWidth = 5;
      ctx.strokeStyle = '#fff';
      notes.forEach(n => {
        if (n.active) {
          ctx.beginPath();
          ctx.arc(n.x, n.y, NOTE_RADIUS, 0, Math.PI*2);
          ctx.stroke();
        }
      });
    }

    // update positions and deactivate when they pass left of judge region (x <= 100)
    function update() {
      notes.forEach(n => {
        if (!n.active) return;
        if (n.x > JUDGE_MIN_X) {
          n.x -= NOTE_SPEED;
        } else {
          n.active = false;
        }
      });
    }

    // handle key press: same as original, any key down attempts to hit any active note within 100..300
    function handleKeydown() {
      for (let i = 0; i < notes.length; i++) {
        const n = notes[i];
        if (!n.active) continue;
        if (n.x >= JUDGE_MIN_X && n.x <= JUDGE_MAX_X) {
          // decide judgement
          const j = getJudgement(n.x);
          n.active = false;
          if (j === 'MISS') {
            combo = 0;
            showTemporaryText('MISS');
          } else if (j) {
            combo += 1;
            showTemporaryText(j);
          } else {
            // out of judgement windows but inside 100..300 (shouldn't happen)
            showTemporaryText('MISS');
            combo = 0;
          }
          comboEl.textContent = combo;
          // only one note should be judged per keypress (mirrors original branching order)
          break;
        }
      }
    }

    // keyboard listener
    window.addEventListener('keydown', () => handleKeydown());

    // main loop
    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // start
    loop();
  </script>
</body>
</html>

